---
title: "Review of LQAS Sampling Plan Calculator"
subtitle: "Brixton Health"
author: "Team 2"
date: '`r format(Sys.Date(), "%B %d, %Y")`'
output: pdf_document
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
Source file/ link: [Brixton Health's sampling plan calculator](http://www.brixtonhealth.com/hyperLQAS.findD.html)

## A. The sampling design

1. Sampling assumptions: simple random sampling without replacement.

2. Type of accuracy used for the calculator:
* no mention of confidence interval
* no mention of coefficient of variation
* other: type I error, $\alpha$, and type II error, $\beta$.

3. The calculator only performs sampling plan calculation for single sampling.

4. LQAS is identical to stratified sampling in which the samples are too small to provide acceptably narrow confidence intervals for estimates [@lemeshowstroh1989].

5. Deal with proportion.

6. No mention of non-response.

7. Clustering not applicable. 

8. No mention of design effect.

9. Study type(s) this calculator would be suitable for: 
* Point in time surveys to estimate a proportion
* Humanitarian surveys
* Comparative surveys


## B. Checking the calculator calculation

*Specifications:*
The calculator uses the following default specifications: 
* Population size, $N = 600$ 
* Upper threshold, $P = P_0 = 0.8$
* Lower threshold, $P = P_a = 0.5$
* Sample size, $n = 50$
* Maximum tolerable $\lapha$ error = 0.1
* Maximum tolerable $\beta$ error = 0.1


```{r}
# specifications
N <- 600      # population size
n <- 50       # sample size
p_0 <- 0.8    # upper threshold
p_a <- 0.5    # lower threshold
alpha <- 0.1
beta <- 0.1

```


### Reference: Lemeshow and Stroh (1989)

```{r}
type1_error_hyper <- phyper(q=33, m = N*p_0, n = (N-N*p_0), k = n)
type1_1error_hyper
```

```{r}
power_of_test <- phyper(q=33, m = N*p_a, n = (N-N*p_a), k = n)
type2_error_hyper <- 1 - power_of_test
type2_error_hyper
```


### Reference: Lemeshow & Taber (1991)

Hypergeometric distribution is represented by the following formula [@lemeshowtaber1991]:
$$
\mathrm{P}(d \le d^*) = \sum_{d=0}^{d^*} \frac{\binom{NP_0}{d} \binom{N(1-P_0)}{n-d}}{\binom{N}{n}}
$$
The mean and variance of hypergeometric distribution with sample size $n$ and the hypothesized proportion $P_0$ are:

$$
\mathrm{mean}(d) = nP_0
$$
and
$$
\mathrm{var}(d) = nP_0(1-P_0)\left( \frac{N-n}{N-1} \right)
$$

If the calculator uses normal approximation to the hypergeometric distribution, then $d$ would be calculated as:
$$
d^* = nP_0 - z_{1-\alpha} \sqrt{nP_0(1-P_0)\left( \frac{N-n}{N-1}\right)}  
$$
Because $P_a$ and $\beta$ are also specified in the calculator, 

$$
d^* = nP_0 - z_{1-\beta} \sqrt{nP_a(1-P_a)\left( \frac{N-n}{N-1}\right)}  
$$

Setting the above two equations for $d$ equal to each other, and solving for $n$:
$$
n = \left(\frac{z_{1-\alpha} \sqrt{P_0(1-P_0)} + z_{1-\beta} \sqrt{P_a(1-P_a)}}{(P_0 - P_a)}  \right)^2
$$


```{r}
z_0 <- qnorm(alpha, lower.tail = FALSE)
z_a <- qnorm(beta, lower.tail = FALSE)
paste0("z_0: ", round(z_0,3))
paste0("z_a: ", round(z_a,3))

# calculate n that makes the two d* equations equals
numer <- z_0*sqrt(p_0*(1-p_0)) + z_a*sqrt(p_a*(1-p_a))
denom <- p_0 - p_a

n_calc <- ceiling((numer / denom)^2)
d_star <- n_calc*p_0 - (z_0 * sqrt(n_calc*p_0*(1-p_0)))

paste0("n: ", n_calc)
paste0("d_star: ", ceiling(d_star))
```





